{% load staticfiles %}<!doctype html>
<html>
    <head>
        <title>YTTS</title>
        {% if subtitles %}
        <script>
            var initSubtitles = {{ subtitles.subtitles|safe }};
            var initIsDefault = {{ subtitles.is_default_version|yesno:"true,false" }};
            var initVersion = "{{ subtitles.version }}";
            var initVersions = {{ all_versions|safe }};
        </script>
        <script src="{% static "ytts/axios.min.js" %}" ></script>
        <script src="{% static "ytts/vue.min.js" %}" ></script>
        <script src="{% static "ytts/vuex@2.1.1.js" %}" ></script>
        <script src="{% static "ytts/main.js" %}" defer></script>
        {% endif %}
        <link rel="stylesheet" href="{% static "ytts/main.css" %}" />
    </head>
    <body>
        <div id="yttsApp">
       
            <h1>Timestamper</h1>
        
            <div id="subtitlesVersions">
                
                <ytts-twostepsselection 
                :selected-option="loadedVersion" 
                :available-options="availableVersions" 
                v-on:select-option="$store.dispatch('loadSubtitles', $event)">
                    <span slot="selected-label-text">Loaded version</span>
                    <span slot="available-label-text">Available versions</span>
                    <span slot="select-button-text">Load version</span>
                </ytts-twostepsselection>
                <span class="warning">If you decide to load another version the current work will be lost</span>

                <div>
                    Create new version: 
                    <input id="versionToCreate" type="text" maxlength="20" placeholder="name (max 20 chars)">
                    Clone current:<input id="versionIsClone" type="checkbox" value="clone">
                    <button id="versionControlCreate">Create New Version</button>
                </div>
            </div>

            <div id="ytplayer" data-initvideoid="{{ video_id }}"></div>

            <div id="timestampBar">
                <div id="timestampBarNow"></div>
            </div>

            <div id="activeLine"></div>

            <ytts-subtitles></ytts-subtitles>
            
        </div>
        
        <template id="subtitlesTemplate">
            <div>
                <div id="subtitlesControls">
                    <button id="subtitleControlAdd" v-on:click="addSubtitle">Add subtitle</button>
                    <button v-on:click="saveSubtitles">Save subtitles</button>
                    <a href="" id="subtitleControlDownload" download="subtitles.srt" v-on:click="downloadSubtitles">DL (SubRip)</a>
                </div>
                <div>
                    <ytts-subtitle v-for="(subtitle, index) in subtitles" :subtitle="subtitle" :index="index"></ytts-subtitle>
                </div>
                <div id="savingFeedback" style="display:none">Saving...</div>        
            </div>
        </template>

        <template id="subtitleTemplate">
            <div class="subtitle" data-subtitle='true'>
                <div data-subtitleinsert="before" draggable="true" ondragover="ytts.dragover_handler(event)" ondrop="ytts.drop_handler(event)" ondragstart="ytts.dragstartSubtitle(event)"></div>
                <textarea data-subtitletext v-model="subtitle.subtitle"></textarea>
                <input type="text" data-start v-model="subtitle.start" />
                <input type="text" data-subtitlestop v-model="subtitle.stop" />
                <button v-on:click="setStart">Start here</button>
                <button v-on:click="setStop">Stop here</button>
                <button onclick="ytts.setCursorAtSubtitle(event)">Position in Video</button>
                <div data-subtitleinsert="after" draggable="true" ondragover="ytts.dragover_handler(event)" ondrop="ytts.drop_handler(event)" ondragstart="ytts.dragstartSubtitle(event)"></div>
            </div>
        </template>
        
        <template id="loaderTemplate">
        <div>
            Available versions
            <select name="version" id="versionToLoad" v-model="selectedVersion">
                <option v-for="v in availableVersions" :value="v">{% verbatim %}{{ v }}{% endverbatim %}</option>
            </select>
            <button id="versionControlLoad" v-on:click="loadVersion">Load Version</button>
            <span class="warning">If you decide to load another version the current work will be lost</span>
        </div>
        </template>

    </body>
</html>
